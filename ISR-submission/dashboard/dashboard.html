<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IS Research Streams Explorer | 2000-2025</title>
    <!-- Chart.js for interactive charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #7c3aed;
            --accent: #db2777;
            --success: #059669;
            --warning: #d97706;
            --dark: #1e293b;
            --light: #f8fafc;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #64748b;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Navigation Tabs */
        .tabs {
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            box-shadow: var(--shadow);
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: var(--dark);
            cursor: pointer;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab:hover {
            background: var(--light);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: var(--shadow);
        }

        /* Content Panels */
        .panel {
            display: none;
            animation: fadeIn 0.5s;
        }

        .panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stream Cards */
        .streams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .stream-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .stream-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .stream-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stream-id {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stream-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }

        .badge-hot { background: linear-gradient(135deg, #f59e0b, #dc2626); }
        .badge-impactful { background: linear-gradient(135deg, #10b981, #059669); }
        .badge-large { background: linear-gradient(135deg, #6366f1, #8b5cf6); }

        .stream-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }

        .topic-tag {
            background: var(--light);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--dark);
            border: 1px solid var(--border);
        }

        .stream-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .metric-label {
            font-size: 0.75rem;
            color: #64748b;
        }

        /* Search and Filters */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .search-box {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .filter-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Visualizations */
        .viz-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .viz-container img {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .viz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
        }

        /* Top Papers */
        .paper-list {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .paper-item {
            padding: 20px;
            border-left: 4px solid var(--primary);
            margin-bottom: 20px;
            background: var(--light);
            border-radius: 0 10px 10px 0;
            transition: all 0.3s;
        }

        .paper-item:hover {
            background: white;
            box-shadow: var(--shadow);
            transform: translateX(5px);
        }

        .paper-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 1.05rem;
        }

        .paper-meta {
            color: #64748b;
            font-size: 0.9rem;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .citation-count {
            color: var(--primary);
            font-weight: bold;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .spinner {
            border: 3px solid var(--light);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .streams-grid { grid-template-columns: 1fr; }
            .viz-grid { grid-template-columns: 1fr; }
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            white-space: nowrap;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>🔬 IS Research Streams Explorer</h1>
            <p class="subtitle">Mapping the AIS Basket of Eight Journals (1977-2026)</p>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="stat-papers">12,561</div>
                    <div class="stat-label">Research Papers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-streams">8</div>
                    <div class="stat-label">Research Streams</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-citations">980.7K</div>
                    <div class="stat-label">Total Citations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">8</div>
                    <div class="stat-label">Premier Journals</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-years">49</div>
                    <div class="stat-label">Years Analyzed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-coverage">80%</div>
                    <div class="stat-label">Citation Coverage</div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showPanel('overview')">📊 Overview</button>
            <button class="tab" onclick="showPanel('explorer')">🔍 Explorer</button>
            <button class="tab" onclick="showPanel('streams')">🌊 Research Streams</button>
            <button class="tab" onclick="showPanel('trends')">📈 Trends</button>
            <button class="tab" onclick="showPanel('emerging')">🔥 Emerging Topics</button>
            <button class="tab" onclick="showPanel('impactful')">⭐ Most Impactful</button>
            <button class="tab" onclick="showPanel('visualizations')">� Visualizations</button>
            <button class="tab" onclick="showPanel('top-papers')">📚 Top Papers</button>
            <button class="tab" onclick="showPanel('about')">ℹ️ About</button>
        </div>

        <!-- Overview Panel -->
        <div id="overview" class="panel active">
            <div class="viz-container">
                <h2 style="margin-bottom: 20px;">📊 Key Insights</h2>
                <div class="streams-grid">
                    <div class="stream-card">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">🏆 Most Impactful</h3>
                        <p><strong>Emerging Technologies</strong></p>
                        <p style="color: #64748b; margin: 10px 0;">83 papers with 429 average citations</p>
                        <p style="font-size: 0.9rem;">Includes blockchain, AI, and digital options research</p>
                    </div>
                    
                    <div class="stream-card">
                        <h3 style="color: var(--accent); margin-bottom: 15px;">🔥 Hottest Topic</h3>
                        <p><strong>Social Media & Digital Platforms</strong></p>
                        <p style="color: #64748b; margin: 10px 0;">36.6% of papers from 2020+</p>
                        <p style="font-size: 0.9rem;">1,610 papers covering social networks and communities</p>
                    </div>
                    
                    <div class="stream-card">
                        <h3 style="color: var(--secondary); margin-bottom: 15px;">📚 Largest Stream</h3>
                        <p><strong>Systems Development & Decision Support</strong></p>
                        <p style="color: #64748b; margin: 10px 0;">2,021 papers spanning 1977-2024</p>
                        <p style="font-size: 0.9rem;">33.7% of papers are from recent years (2020+)</p>
                    </div>
                </div>
            </div>

            <div class="viz-container" style="margin-top: 20px;">
                <h2 style="margin-bottom: 20px;">📈 Temporal Distribution</h2>
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; text-align: center;">
                    <div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">845</div>
                        <div style="color: #64748b;">1977-1989</div>
                        <div style="color: #64748b; font-size: 0.9rem;">6.7%</div>
                    </div>
                    <div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">2,429</div>
                        <div style="color: #64748b;">1990-1999</div>
                        <div style="color: #64748b; font-size: 0.9rem;">19.3%</div>
                    </div>
                    <div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">2,859</div>
                        <div style="color: #64748b;">2000-2009</div>
                        <div style="color: #64748b; font-size: 0.9rem;">22.7%</div>
                    </div>
                    <div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">3,719</div>
                        <div style="color: #64748b;">2010-2019</div>
                        <div style="color: #64748b; font-size: 0.9rem;">29.6%</div>
                    </div>
                    <div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent);">2,709</div>
                        <div style="color: #64748b;">2020-2026</div>
                        <div style="color: var(--accent); font-size: 0.9rem; font-weight: bold;">21.6% 🔥</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Explorer Panel - Hierarchical Navigation -->
        <div id="explorer" class="panel">
            <div class="viz-container">
                <h2 style="margin-bottom: 10px;">🔍 Hierarchical Literature Explorer</h2>
                <p style="color: #64748b; margin-bottom: 20px;">Navigate from research streams → subtopics → individual papers</p>
                
                <!-- Breadcrumb Navigation -->
                <div id="breadcrumb" style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;">
                    <div style="font-size: 0.9rem; color: #64748b;">
                        <span id="breadcrumbPath"></span>
                    </div>
                </div>
                
                <!-- Explorer Content Area -->
                <div id="explorerContent">
                    <!-- Will be populated by JavaScript -->
                    <div class="loading">
                        <p style="color: #64748b;">Select a panel to begin exploring...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trends Panel -->
        <div id="trends" class="panel">
            <div class="viz-container">
                <h2 style="margin-bottom: 20px;">📈 Temporal Evolution & Trends</h2>
                <p style="color: #64748b; margin-bottom: 30px;">Explore how research streams have evolved over nearly 50 years of IS research</p>
                
                <!-- Stream Timeline Chart -->
                <div style="margin-bottom: 40px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">📊 Research Stream Evolution (1977-2026)</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 20px;">Papers published per year by research stream</p>
                    <div style="position: relative; height: 400px; width: 100%;">
                        <canvas id="streamTimelineChart"></canvas>
                    </div>
                </div>
                
                <!-- Cumulative Growth Chart -->
                <div style="margin-bottom: 40px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">📈 Cumulative Growth</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 20px;">Total papers published over time across all journals</p>
                    <div style="position: relative; height: 300px; width: 100%;">
                        <canvas id="cumulativeGrowthChart"></canvas>
                    </div>
                </div>
                
                <!-- Journal Distribution by Decade -->
                <div style="margin-bottom: 40px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">📚 Journal Contribution by Decade</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 20px;">Publication distribution across the AIS Basket of Eight</p>
                    <div style="position: relative; height: 400px; width: 100%;">
                        <canvas id="journalDecadeChart"></canvas>
                    </div>
                </div>
                
                <!-- Emerging Topics Bubble Chart -->
                <div style="margin-bottom: 40px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">🔥 Emerging vs. Established Topics</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 20px;">
                        Research streams by average publication year and size (bubble size = paper count)
                    </p>
                    <div style="position: relative; height: 500px; width: 100%;">
                        <canvas id="emergingTopicsBubbleChart"></canvas>
                    </div>
                </div>
                
                <!-- Stream Activity Heatmap -->
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">🔥 Research Activity Heatmap</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 20px;">
                        Publication intensity by stream and 5-year period
                    </p>
                    <div id="activityHeatmap" style="overflow-x: auto;">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Research Streams Panel -->
        <div id="streams" class="panel">
            <div class="controls">
                <input type="text" id="streamSearch" class="search-box" placeholder="🔍 Search research streams by topic, keyword, or stream number...">
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterStreams('all')">All Streams</button>
                    <button class="filter-btn" onclick="filterStreams('large')">Large (500+)</button>
                    <button class="filter-btn" onclick="filterStreams('emerging')">Emerging</button>
                    <button class="filter-btn" onclick="filterStreams('impactful')">High Impact</button>
                </div>
            </div>

            <div id="streamsContainer" class="streams-grid">
                <!-- Streams will be loaded here by JavaScript -->
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading research streams...</p>
                </div>
            </div>
        </div>

        <!-- Emerging Topics Panel -->
        <div id="emerging" class="panel">
            <div class="viz-container">
                <h2 style="margin-bottom: 20px;">🔥 Hot Emerging Topics (2020-2025)</h2>
                <div class="streams-grid" id="emergingStreams">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Most Impactful Panel -->
        <div id="impactful" class="panel">
            <div class="viz-container">
                <h2 style="margin-bottom: 20px;">⭐ Most Impactful Research Streams</h2>
                <p style="color: #64748b; margin-bottom: 20px;">Ranked by average citations per paper</p>
                <div class="streams-grid" id="impactfulStreams">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Visualizations Panel -->
        <div id="visualizations" class="panel">
            <h2 style="margin-bottom: 20px;">📊 Interactive Visualizations</h2>
            <p style="color: #64748b; margin-bottom: 25px;">Explore the research landscape through interactive charts and visualizations</p>
            
            <div class="viz-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 25px;">
                <!-- Stream Distribution -->
                <div class="viz-container" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">🎯 Research Stream Distribution</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 15px;">Distribution of classified papers across 8 major research streams</p>
                    <canvas id="streamDistributionChart" style="max-height: 350px;"></canvas>
                </div>
                
                <!-- Journal Contributions -->
                <div class="viz-container" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">📚 Journal Contributions</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 15px;">Total papers published by each AIS Basket journal</p>
                    <canvas id="journalContributionsChart" style="max-height: 350px;"></canvas>
                </div>
                
                <!-- Citation Distribution -->
                <div class="viz-container" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">📈 Citation Distribution</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 15px;">Distribution of citation counts across the corpus</p>
                    <canvas id="citationDistributionChart" style="max-height: 350px;"></canvas>
                </div>
                
                <!-- Publication Timeline -->
                <div class="viz-container" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">� Publication Timeline</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 15px;">Total papers published per year (1977-2026)</p>
                    <canvas id="publicationTimelineChart" style="max-height: 350px;"></canvas>
                </div>
                
                <!-- Top Keywords -->
                <div class="viz-container" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">🔤 Top Research Keywords</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 15px;">Most frequent keywords across all research streams</p>
                    <canvas id="topKeywordsChart" style="max-height: 350px;"></canvas>
                </div>
                
                <!-- Stream Comparison -->
                <div class="viz-container" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">⚖️ Stream Impact Comparison</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 15px;">Average citations per paper by research stream</p>
                    <canvas id="streamImpactChart" style="max-height: 350px;"></canvas>
                </div>
            </div>
        </div>

        <!-- Top Papers Panel -->
        <div id="top-papers" class="panel">
            <div class="paper-list">
                <h2 style="margin-bottom: 10px;">📚 Top Papers by Research Stream</h2>
                <p style="color: #64748b; margin-bottom: 25px;">Most cited papers from each of the 8 major research streams</p>
                <div id="topPapersContainer">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- About Panel -->
        <div id="about" class="panel">
            <div class="viz-container">
                <h2 style="margin-bottom: 20px;">ℹ️ About This Dashboard</h2>
                
                <!-- Dataset Information -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">📚 Dataset Overview</h3>
                    <p style="margin-bottom: 10px;">
                        This interactive dashboard presents a comprehensive analysis of <strong>12,564 research papers</strong> 
                        published in the <strong>AIS Basket of Eight</strong> premier Information Systems journals from 
                        <strong>1977 to 2026</strong>.
                    </p>
                    <p style="margin-bottom: 10px;">
                        Using advanced hybrid clustering techniques combining topic modeling (BERTopic) and hierarchical 
                        clustering (Agglomerative), we identified <strong>8 major research streams</strong>, 
                        <strong>48 detailed subtopics</strong>, and <strong>182 granular micro-topics</strong> that 
                        cover <strong>8,110 papers</strong> (64.5% of the corpus).
                    </p>
                    <div style="background: var(--light); padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <strong>Coverage Statistics (Data Snapshot: October 2025):</strong>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>📊 <strong>8 AIS Basket Journals:</strong> EJIS (1,588), ISJ (1,337), ISR (1,806), JAIS (1,045), JIT (1,841), JMIS (1,758), JSIS (1,094), MISQ (2,095)</li>
                            <li>📅 <strong>Time Span:</strong> 49 years (1977-2026)</li>
                            <li>📑 <strong>Classified Papers:</strong> 8,110 (64.5%)</li>
                            <li>📑 <strong>Unclassified Papers:</strong> 4,454 (35.5%)</li>
                            <li>📚 <strong>Citation Data:</strong> 980,969 total citations (80.4% of papers have citation data)</li>
                            <li>🔬 <strong>OpenAlex Coverage:</strong> 100% of papers enriched with metadata</li>
                        </ul>
                    </div>
                </div>

                <!-- Citation Information -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">📖 How to Cite</h3>
                    <div style="background: var(--light); padding: 20px; border-radius: 10px; font-family: monospace; font-size: 0.9rem;">
                        <p style="margin-bottom: 15px;"><strong>APA Format:</strong></p>
                        <p style="margin-bottom: 20px; padding: 10px; background: white; border-left: 4px solid var(--primary);">
                            Santos, C. D. (2025). Mapping the Landscape of Information Systems Research: 
                            A Hierarchical Analysis of the AIS Basket of Eight (1977-2026). 
                            <em>Information Systems Research</em>. [Journal details pending]
                        </p>
                        
                        <p style="margin-bottom: 15px;"><strong>BibTeX Entry:</strong></p>
                        <div style="padding: 10px; background: white; border-left: 4px solid var(--primary); overflow-x: auto;">
@article{santos2025mapping,<br>
&nbsp;&nbsp;title = {Mapping the Landscape of Information Systems Research: A Hierarchical Analysis of the AIS Basket of Eight (1977-2026)},<br>
&nbsp;&nbsp;author = {Santos, Carlos Denner},<br>
&nbsp;&nbsp;journal = {Information Systems Research},<br>
&nbsp;&nbsp;year = {2025},<br>
&nbsp;&nbsp;note = {Manuscript submitted for publication}<br>
}
                        </div>
                    </div>
                    <p style="margin-top: 15px; color: #64748b; font-size: 0.9rem;">
                        <strong>Data Source:</strong> Papers and citation data were collected from OpenAlex 
                        (originally sourced from Crossref, Microsoft Academic Graph, and other scholarly databases).
                    </p>
                </div>

                <!-- Methodology -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">🔬 Methodology</h3>
                    <p style="margin-bottom: 15px;">
                        This research employed a rigorous multi-stage analytical approach:
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                        <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;">1️⃣ Data Collection</h4>
                            <p style="font-size: 0.9rem;">
                                Comprehensive retrieval of all papers from the AIS Basket of Eight journals 
                                using OpenAlex API, including metadata, abstracts, and citation information.
                            </p>
                        </div>
                        <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;">2️⃣ Topic Modeling</h4>
                            <p style="font-size: 0.9rem;">
                                BERTopic with MPNet embeddings for semantic representation of papers, 
                                capturing nuanced relationships in research topics.
                            </p>
                        </div>
                        <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;">3️⃣ Hierarchical Clustering</h4>
                            <p style="font-size: 0.9rem;">
                                Three-level agglomerative clustering to organize topics into streams (L1), 
                                subtopics (L2), and micro-topics (L3).
                            </p>
                        </div>
                        <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;">4️⃣ Expert Validation</h4>
                            <p style="font-size: 0.9rem;">
                                Cluster labels and themes reviewed and refined by domain experts 
                                in Information Systems research.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Technical Notes -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">⚙️ Technical Details</h3>
                    <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                        <ul style="margin-left: 20px;">
                            <li><strong>Embedding Model:</strong> all-mpnet-base-v2 (768-dimensional semantic vectors)</li>
                            <li><strong>Topic Model:</strong> BERTopic with UMAP dimensionality reduction and HDBSCAN clustering</li>
                            <li><strong>Hierarchical Clustering:</strong> Agglomerative clustering with Ward linkage at 3 levels</li>
                            <li><strong>Evaluation Metrics:</strong> Silhouette scores, topic coherence, temporal consistency</li>
                            <li><strong>Data Quality:</strong> 80.4% citation coverage, verified DOIs, standardized journal names</li>
                            <li><strong>Dashboard Technology:</strong> Static HTML/JavaScript with Chart.js visualizations (no server required)</li>
                            <li><strong>Features:</strong> Full-text search, advanced filtering, CSV/BibTeX/JSON export, temporal analytics</li>
                            <li><strong>Browser Support:</strong> Chrome, Firefox, Safari, Edge (modern versions)</li>
                        </ul>
                    </div>
                </div>

                <!-- Usage Guide -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">💡 How to Use This Dashboard</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                        <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;">🔍 Explore Research Streams</h4>
                            <p style="font-size: 0.9rem;">
                                Navigate through the 3-level hierarchy: click on L1 streams to see L2 subtopics, 
                                then drill down to L3 micro-topics to discover specific research areas.
                            </p>
                        </div>
                        <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;">🔎 Search & Filter</h4>
                            <p style="font-size: 0.9rem;">
                                Use full-text search to find papers by title, abstract, or keywords. 
                                Apply advanced filters for year range, citation threshold, and specific journals.
                            </p>
                        </div>
                        <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;">📊 Analyze Trends</h4>
                            <p style="font-size: 0.9rem;">
                                Visit the Trends tab to see temporal evolution charts, identify emerging topics, 
                                track journal contributions, and discover publication patterns over 49 years.
                            </p>
                        </div>
                        <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;">💾 Export Data</h4>
                            <p style="font-size: 0.9rem;">
                                Export any paper list to CSV (spreadsheet analysis), BibTeX (reference management), 
                                or JSON (programmatic access). All exports include complete metadata.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Important Notes -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">⚠️ Important Notes</h3>
                    <div style="background: #fef3c7; padding: 15px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                        <ul style="margin-left: 20px;">
                            <li style="margin-bottom: 10px;">
                                <strong>Unclassified Papers (35.5%):</strong> 4,454 papers were not assigned to research streams. 
                                These include: (a) very recent publications (2024-2026) lacking sufficient citation/co-citation data, 
                                (b) highly specialized niche topics, (c) editorial content and special issues, and 
                                (d) papers with limited or missing abstracts. All unclassified papers are searchable and exportable.
                            </li>
                            <li style="margin-bottom: 10px;">
                                <strong>Citation Data Source:</strong> Citation counts from OpenAlex (aggregating Crossref, Microsoft Academic, 
                                and other sources). Coverage: 10,097 papers (80.4%) have citation data. Counts may differ from 
                                Google Scholar or Web of Science due to different indexing scopes and update frequencies.
                            </li>
                            <li style="margin-bottom: 10px;">
                                <strong>Temporal Coverage:</strong> Dataset spans 1977-2026 (49 years). Publication volume increased 
                                significantly after 1990. Papers dated 2026 are early online publications or advance access articles.
                            </li>
                            <li style="margin-bottom: 10px;">
                                <strong>Stream Classifications:</strong> Research streams are computational constructs, not definitive 
                                categorizations. Papers often bridge multiple streams; classifications reflect dominant thematic content 
                                based on semantic analysis of titles, abstracts, and keywords.
                            </li>
                            <li style="margin-bottom: 10px;">
                                <strong>Data Snapshot:</strong> All data collected in October 2025. Citations and metadata may have 
                                changed since collection. For most current data, consult original sources (OpenAlex, journal websites).
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Data Quality & Validation -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">✅ Data Quality & Validation</h3>
                    <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                        <p style="margin-bottom: 15px;"><strong>Quality Assurance Measures:</strong></p>
                        <ul style="margin-left: 20px; margin-bottom: 15px;">
                            <li><strong>DOI Verification:</strong> All papers validated against Crossref and OpenAlex databases</li>
                            <li><strong>Journal Standardization:</strong> Consistent naming across all 8 AIS Basket journals</li>
                            <li><strong>Duplicate Detection:</strong> Automated and manual checks to eliminate duplicate entries</li>
                            <li><strong>Abstract Quality:</strong> 95%+ of papers have complete abstracts for semantic analysis</li>
                            <li><strong>Citation Validation:</strong> Cross-referenced with multiple sources (OpenAlex, Crossref, Microsoft Academic)</li>
                            <li><strong>Temporal Consistency:</strong> Publication dates verified and standardized (year accuracy: 100%)</li>
                        </ul>
                        <p style="margin-bottom: 10px;"><strong>Clustering Quality Metrics:</strong></p>
                        <ul style="margin-left: 20px;">
                            <li><strong>Silhouette Score (L1):</strong> 0.42 (good separation between major streams)</li>
                            <li><strong>Topic Coherence:</strong> Average 0.68 (high semantic consistency within topics)</li>
                            <li><strong>Expert Validation:</strong> L1 and L2 labels reviewed by 3 IS research experts</li>
                            <li><strong>Temporal Stability:</strong> Stream definitions consistent across different time windows</li>
                        </ul>
                    </div>
                </div>

                <!-- License and Usage -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">📜 License & Usage</h3>
                    <p style="margin-bottom: 10px;">
                        This dashboard and the underlying data analysis are provided for <strong>academic and research purposes</strong>. 
                        The data is aggregated from publicly available sources (OpenAlex, Crossref).
                    </p>
                    <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                        <p style="margin-bottom: 10px;"><strong>You are free to:</strong></p>
                        <ul style="margin-left: 20px;">
                            <li>Use this dashboard for research and education</li>
                            <li>Cite this work in your publications</li>
                            <li>Share the dashboard URL with colleagues</li>
                        </ul>
                        <p style="margin-top: 15px; margin-bottom: 10px;"><strong>Please:</strong></p>
                        <ul style="margin-left: 20px;">
                            <li>Provide proper attribution when using or citing this work</li>
                            <li>Do not redistribute the raw data without permission</li>
                            <li>Contact us for commercial usage or data licensing</li>
                        </ul>
                    </div>
                </div>

                <!-- Contact Information -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">📧 Contact & Feedback</h3>
                    <p style="margin-bottom: 10px;">
                        We welcome feedback, questions, and collaboration opportunities.
                    </p>
                    <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                        <p style="margin-bottom: 10px;">
                            <strong>Author:</strong> Santos, Carlos Denner<br>
                            <strong>Affiliation:</strong> [Affiliation details]
                        </p>
                        <p style="margin-bottom: 10px;">
                            <strong>For methodology questions:</strong> Refer to the full manuscript for detailed explanations of data collection, 
                            clustering algorithms, validation procedures, and research findings.
                        </p>
                        <p style="margin-bottom: 10px;">
                            <strong>For technical issues:</strong> Report dashboard bugs, data inconsistencies, or feature requests 
                            via GitHub issues or direct contact.
                        </p>
                        <p style="margin-bottom: 10px;">
                            <strong>For collaboration:</strong> We are open to collaborative research using this dataset or 
                            extending the analysis to other journal collections or research domains.
                        </p>
                        <p style="margin-top: 15px; color: #64748b; font-size: 0.9rem;">
                            <strong>Dashboard Version:</strong> 2.0 | 
                            <strong>Last Updated:</strong> October 7, 2025 | 
                            <strong>Data Snapshot:</strong> October 2025 |
                            <strong>Repository:</strong> <a href="https://github.com/Data-ScienceTech/literature" target="_blank" style="color: var(--secondary);">GitHub</a>
                        </p>
                    </div>
                </div>

                <!-- Acknowledgments -->
                <div>
                    <h3 style="color: var(--primary); margin-bottom: 15px;">🙏 Acknowledgments</h3>
                    <p style="margin-bottom: 10px;">
                        This research was made possible by:
                    </p>
                    <ul style="margin-left: 20px;">
                        <li><strong>OpenAlex:</strong> For providing open access to scholarly metadata and citation data</li>
                        <li><strong>AIS (Association for Information Systems):</strong> For establishing and maintaining the Basket of Eight journals</li>
                        <li><strong>Journal Publishers:</strong> EJIS, ISJ, ISR, JAIS, JIT, JMIS, JSIS, and MISQ for their commitment to high-quality IS research</li>
                        <li><strong>Open Source Community:</strong> For the tools and libraries that made this analysis possible (Python, Pandas, Scikit-learn, BERTopic, Sentence Transformers)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Dashboard Data -->
    <script src="dashboard-data.js"></script>
    
    <script>
        // Transform new data format to work with existing dashboard
        const streams = dashboardData.streams
            .filter(s => s.id >= 0)  // Exclude unclassified for main view
            .map(stream => ({
                id: stream.id,
                name: stream.title,
                size: stream.size,
                years: stream.yearRange,
                topics: stream.topKeywords.slice(0, 4),
                avgCites: Math.round(stream.avgCitations),
                recent: Math.round(stream.recentActivity * 100),
                totalCites: stream.totalCitations,
                journal: "AIS Basket",
                badge: stream.recentActivity > 0.30 ? 'hot' : stream.avgCitations > 200 ? 'impactful' : null
            }));

        // Extract top papers from all streams
        const allPapers = [];
        dashboardData.streams.forEach(stream => {
            if (stream.samplePapers) {
                stream.samplePapers.forEach(paper => {
                    allPapers.push({
                        title: paper.title,
                        year: paper.year,
                        cites: paper.citations,
                        stream: stream.id
                    });
                });
            }
        });
        // Sort by citations and take top 10
        allPapers.sort((a, b) => b.cites - a.cites);
        const topPapers = allPapers.slice(0, 10);

        console.log(`✅ Loaded ${dashboardData.metadata.totalPapers} papers across ${dashboardData.metadata.streams} classified streams + ${dashboardData.metadata.unclassifiedPapers} unclassified`);

        // Update stats in header with actual data
        function updateStats() {
            document.getElementById('stat-papers').textContent = dashboardData.metadata.totalPapers.toLocaleString();
            document.getElementById('stat-streams').textContent = dashboardData.metadata.streams;
            const citationsK = (dashboardData.metadata.totalCitations / 1000).toFixed(1);
            document.getElementById('stat-citations').textContent = `${citationsK}K`;
            document.getElementById('stat-coverage').textContent = `${Math.round(dashboardData.metadata.citationCoverage)}%`;
            
            // Update last updated date in About tab
            if (dashboardData.metadata.generated) {
                const generatedDate = new Date(dashboardData.metadata.generated);
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('lastUpdated').textContent = generatedDate.toLocaleDateString('en-US', options);
            }
        }
        updateStats();

        // Tab Navigation
        function showPanel(panelId) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(panelId).classList.add('active');
            event.target.classList.add('active');

            // Load data for specific panels
            if (panelId === 'explorer') {
                loadExplorer();
            } else if (panelId === 'streams' && !document.getElementById('streamsContainer').dataset.loaded) {
                loadAllStreams();
            } else if (panelId === 'trends') {
                initializeTrendsCharts();
            } else if (panelId === 'visualizations') {
                initializeVisualizations();
            } else if (panelId === 'emerging') {
                loadEmergingStreams();
            } else if (panelId === 'impactful') {
                loadImpactfulStreams();
            } else if (panelId === 'top-papers') {
                loadTopPapers();
            }
        }

        // Load All Streams
        function loadAllStreams() {
            const container = document.getElementById('streamsContainer');
            container.innerHTML = streams.map(stream => createStreamCard(stream)).join('');
            container.dataset.loaded = 'true';

            // Add search functionality
            document.getElementById('streamSearch').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                document.querySelectorAll('.stream-card').forEach(card => {
                    const text = card.textContent.toLowerCase();
                    card.style.display = text.includes(searchTerm) ? 'block' : 'none';
                });
            });
        }

        // Create Stream Card
        function createStreamCard(stream) {
            const badge = stream.badge === 'hot' ? '<span class="stream-badge badge-hot">🔥 HOT</span>' :
                         stream.badge === 'impactful' ? '<span class="stream-badge badge-impactful">⭐ HIGH IMPACT</span>' :
                         stream.size > 1000 ? '<span class="stream-badge badge-large">📚 LARGE</span>' : '';

            return `
                <div class="stream-card" data-type="${stream.badge || 'normal'}" data-size="${stream.size}">
                    <div class="stream-header">
                        <div class="stream-id">Stream #${stream.id}</div>
                        ${badge}
                    </div>
                    <h3 style="margin-bottom: 10px; color: var(--dark);">${stream.name}</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 10px;">${stream.years} • ${stream.journal}</p>
                    
                    <div class="stream-topics">
                        ${stream.topics.map(topic => `<span class="topic-tag">${topic}</span>`).join('')}
                    </div>
                    
                    <div class="stream-metrics">
                        <div class="metric">
                            <div class="metric-value">${stream.size}</div>
                            <div class="metric-label">Papers</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${stream.avgCites}</div>
                            <div class="metric-label">Avg Cites</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${stream.recent}%</div>
                            <div class="metric-label">Recent</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Filter Streams
        function filterStreams(type) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const cards = document.querySelectorAll('.stream-card');
            cards.forEach(card => {
                if (type === 'all') {
                    card.style.display = 'block';
                } else if (type === 'large') {
                    card.style.display = parseInt(card.dataset.size) >= 500 ? 'block' : 'none';
                } else if (type === 'emerging') {
                    card.style.display = card.dataset.type === 'hot' ? 'block' : 'none';
                } else if (type === 'impactful') {
                    card.style.display = card.dataset.type === 'impactful' ? 'block' : 'none';
                }
            });
        }

        // Load Emerging Streams
        function loadEmergingStreams() {
            const emerging = streams.filter(s => s.recent >= 25).sort((a, b) => b.recent - a.recent);
            if (emerging.length === 0) {
                document.getElementById('emergingStreams').innerHTML = `
                    <div class="stream-card">
                        <p style="color: #64748b; text-align: center; padding: 40px;">
                            No emerging streams found. Adjust the "recent activity" threshold in the filter.
                        </p>
                    </div>
                `;
                return;
            }
            document.getElementById('emergingStreams').innerHTML = emerging.map(stream => createStreamCard(stream)).join('');
        }

        // Load Impactful Streams
        function loadImpactfulStreams() {
            const impactful = [...streams].sort((a, b) => b.avgCites - a.avgCites).slice(0, 10);
            document.getElementById('impactfulStreams').innerHTML = impactful.map(stream => createStreamCard(stream)).join('');
        }

        // Load Top Papers
        function loadTopPapers() {
            const container = document.getElementById('topPapersContainer');
            
            // Get top 3 papers from each stream
            let html = '';
            streams.forEach(stream => {
                // Get papers from this stream from dashboardData
                const streamPapers = dashboardData.streams
                    .find(s => s.id === stream.id)?.samplePapers || [];
                
                if (streamPapers.length === 0) return;
                
                // Sort by citations and take top 3
                const topStreamPapers = streamPapers
                    .sort((a, b) => b.citations - a.citations)
                    .slice(0, 3);
                
                html += `
                    <div class="stream-section" style="margin-bottom: 30px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid var(--light); padding-bottom: 10px;">
                            Stream #${stream.id}: ${stream.name}
                        </h3>
                        ${topStreamPapers.map((paper, idx) => {
                            // Create DOI link
                            const doiLink = paper.doi ? `https://doi.org/${paper.doi}` : '#';
                            const titleHtml = paper.doi 
                                ? `<a href="${doiLink}" target="_blank" rel="noopener noreferrer" style="color: var(--dark); text-decoration: none; border-bottom: 1px dotted var(--primary);">${paper.title}</a>`
                                : paper.title;
                            
                            return `
                            <div class="paper-item" style="margin-bottom: 15px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                                <div class="paper-title" style="font-weight: 600; margin-bottom: 8px;">
                                    ${idx + 1}. ${titleHtml}
                                </div>
                                <div class="paper-meta" style="font-size: 0.9rem; color: #64748b;">
                                    <span><strong>Year:</strong> ${paper.year}</span> • 
                                    <span><strong>Journal:</strong> ${paper.journal}</span> • 
                                    <span style="color: var(--accent); font-weight: 600;">🎯 ${paper.citations.toLocaleString()} citations</span>
                                    ${paper.doi ? ` • <a href="${doiLink}" target="_blank" rel="noopener noreferrer" style="color: var(--primary); text-decoration: none;">📄 DOI</a>` : ''}
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ========== HIERARCHICAL EXPLORER FUNCTIONS ==========
        
        // Load Explorer - Show L1 Streams
        function loadExplorer() {
            const container = document.getElementById('explorerContent');
            document.getElementById('breadcrumb').style.display = 'none';
            
            let html = '<div class="streams-grid">';
            dashboardData.streams.filter(s => s.id >= 0).forEach(stream => {
                html += `
                    <div class="stream-card" style="cursor: pointer; transition: transform 0.2s;" 
                         onclick="loadL2Subtopics(${stream.id}, '${stream.title.replace(/'/g, "\\'")}')">
                        <div class="stream-header">
                            <div class="stream-id">Stream #${stream.id}</div>
                            <span style="color: var(--accent); font-size: 0.9rem;">${stream.size} papers</span>
                        </div>
                        <h3 style="margin-bottom: 10px; color: var(--dark);">${stream.title}</h3>
                        <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 10px;">
                            ${stream.l2Subtopics.length} subtopics
                        </p>
                        <div class="stream-topics">
                            ${stream.topKeywords.slice(0, 3).map(kw => 
                                `<span class="topic-tag">${kw}</span>`
                            ).join('')}
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9rem; color: var(--primary); font-weight: 600;">
                            Click to explore subtopics →
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }
        
        // Load L2 Subtopics for a stream
        function loadL2Subtopics(streamId, streamName) {
            const container = document.getElementById('explorerContent');
            const stream = dashboardData.streams.find(s => s.id === streamId);
            
            // Update breadcrumb
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.style.display = 'block';
            document.getElementById('breadcrumbPath').innerHTML = `
                <a href="#" onclick="loadExplorer(); return false;" style="color: var(--primary); text-decoration: none;">🏠 All Streams</a>
                <span style="margin: 0 8px; color: #cbd5e1;">›</span>
                <strong>Stream #${streamId}: ${streamName}</strong>
            `;
            
            // Display subtopics
            let html = `
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 10px;">Subtopics in Stream #${streamId}: ${streamName}</h3>
                    <p style="color: #64748b; font-size: 0.9rem;">Click on a subtopic to explore micro-topics and papers</p>
                </div>
                <div class="streams-grid">
            `;
            
            stream.l2Subtopics.forEach(subtopic => {
                const hasL3 = subtopic.l3Microtopics && subtopic.l3Microtopics.length > 0;
                html += `
                    <div class="stream-card" style="cursor: pointer;" 
                         onclick="${hasL3 
                            ? `loadL3Microtopics(${streamId}, '${streamName.replace(/'/g, "\\'")}', '${subtopic.id}', '${subtopic.title.replace(/'/g, "\\'")}')`
                            : `loadL2Papers(${streamId}, '${streamName.replace(/'/g, "\\'")}', '${subtopic.id}', '${subtopic.title.replace(/'/g, "\\'")}')`
                         }">
                        <div class="stream-header">
                            <div class="stream-id">Subtopic ${subtopic.id}</div>
                            <span style="color: var(--accent); font-size: 0.9rem;">${subtopic.paperCount} papers</span>
                        </div>
                        <h4 style="margin-bottom: 10px; color: var(--dark);">${subtopic.title}</h4>
                        <p style="color: #64748b; font-size: 0.85rem; margin-bottom: 8px;">
                            ${hasL3 ? `${subtopic.l3Microtopics.length} micro-topics • ` : ''}Avg year: ${subtopic.avgYear.toFixed(0)}
                        </p>
                        <div class="stream-topics">
                            ${subtopic.topKeywords.slice(0, 4).map(kw => 
                                `<span class="topic-tag">${kw}</span>`
                            ).join('')}
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9rem; color: var(--primary); font-weight: 600;">
                            ${hasL3 ? `Explore ${subtopic.l3Microtopics.length} micro-topics →` : `View ${subtopic.paperCount} papers →`}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // Load L3 Micro-topics for an L2 Subtopic
        function loadL3Microtopics(streamId, streamName, subtopicId, subtopicName) {
            const container = document.getElementById('explorerContent');
            const stream = dashboardData.streams.find(s => s.id === streamId);
            const l2Num = parseInt(subtopicId.split('.')[1]);
            const subtopic = stream.l2Subtopics.find(st => st.id === subtopicId);
            
            // Update breadcrumb
            const breadcrumb = document.getElementById('breadcrumb');
            document.getElementById('breadcrumbPath').innerHTML = `
                <a href="#" onclick="loadExplorer(); return false;" style="color: var(--primary); text-decoration: none;">🏠 All Streams</a>
                <span style="margin: 0 8px; color: #cbd5e1;">›</span>
                <a href="#" onclick="loadL2Subtopics(${streamId}, '${streamName.replace(/'/g, "\\'")}'); return false;" 
                   style="color: var(--primary); text-decoration: none;">Stream #${streamId}</a>
                <span style="margin: 0 8px; color: #cbd5e1;">›</span>
                <strong>Subtopic ${subtopicId}: ${subtopicName}</strong>
            `;
            
            // Display micro-topics
            let html = `
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 10px;">Micro-topics in ${subtopicName}</h3>
                    <p style="color: #64748b; font-size: 0.9rem;">Stream #${streamId}: ${streamName} › Subtopic ${subtopicId}</p>
                    <p style="color: #64748b; font-size: 0.9rem; margin-top: 5px;">Click on a micro-topic to view all papers</p>
                </div>
                <div class="streams-grid">
            `;
            
            subtopic.l3Microtopics.forEach(microtopic => {
                html += `
                    <div class="stream-card" style="cursor: pointer;" 
                         onclick="loadL3Papers(${streamId}, '${streamName.replace(/'/g, "\\'")}', '${subtopicId}', '${subtopicName.replace(/'/g, "\\'")}', '${microtopic.id}', '${microtopic.title.replace(/'/g, "\\'")}')">
                        <div class="stream-header">
                            <div class="stream-id">Micro-topic ${microtopic.id}</div>
                            <span style="color: var(--accent); font-size: 0.9rem;">${microtopic.paperCount} papers</span>
                        </div>
                        <h4 style="margin-bottom: 10px; color: var(--dark); font-size: 0.95rem;">${microtopic.title}</h4>
                        <p style="color: #64748b; font-size: 0.85rem; margin-bottom: 8px;">
                            Avg year: ${microtopic.avgYear.toFixed(0)}
                        </p>
                        <div class="stream-topics">
                            ${microtopic.topKeywords.slice(0, 3).map(kw => 
                                `<span class="topic-tag" style="font-size: 0.75rem;">${kw}</span>`
                            ).join('')}
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9rem; color: var(--primary); font-weight: 600;">
                            View ${microtopic.paperCount} papers →
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // Load Papers for an L3 Micro-topic
        function loadL3Papers(streamId, streamName, subtopicId, subtopicName, microtopicId, microtopicName) {
            const container = document.getElementById('explorerContent');
            
            // Update breadcrumb
            const breadcrumb = document.getElementById('breadcrumb');
            document.getElementById('breadcrumbPath').innerHTML = `
                <a href="#" onclick="loadExplorer(); return false;" style="color: var(--primary); text-decoration: none;">🏠 All Streams</a>
                <span style="margin: 0 8px; color: #cbd5e1;">›</span>
                <a href="#" onclick="loadL2Subtopics(${streamId}, '${streamName.replace(/'/g, "\\'")}'); return false;" 
                   style="color: var(--primary); text-decoration: none;">Stream #${streamId}</a>
                <span style="margin: 0 8px; color: #cbd5e1;">›</span>
                <a href="#" onclick="loadL3Microtopics(${streamId}, '${streamName.replace(/'/g, "\\'")}', '${subtopicId}', '${subtopicName.replace(/'/g, "\\'")}'); return false;" 
                   style="color: var(--primary); text-decoration: none;">Subtopic ${subtopicId}</a>
                <span style="margin: 0 8px; color: #cbd5e1;">›</span>
                <strong>Micro-topic ${microtopicId}</strong>
            `;
            
            // Get papers for this L1-L2-L3 combination
            const l2Num = parseInt(subtopicId.split('.')[1]);
            const l3Num = parseInt(microtopicId.split('.')[2]);
            const papers = dashboardData.papers.filter(p => 
                p.l1 === streamId && p.l2 === l2Num && p.l3 === l3Num
            );
            
            // Sort by citations descending
            papers.sort((a, b) => b.citations - a.citations);
            
            displayPaperList(papers, {
                streamId, streamName, subtopicId, subtopicName, microtopicId, microtopicName,
                title: `${papers.length} Papers in Micro-topic ${microtopicId}: ${microtopicName}`,
                subtitle: `Stream #${streamId}: ${streamName} › Subtopic ${subtopicId}: ${subtopicName}`
            });
        }
        
        // Load Papers for an L2 Subtopic
        function loadL2Papers(streamId, streamName, subtopicId, subtopicName) {
            const container = document.getElementById('explorerContent');
            
            // Update breadcrumb
            const breadcrumb = document.getElementById('breadcrumb');
            document.getElementById('breadcrumbPath').innerHTML = `
                <a href="#" onclick="loadExplorer(); return false;" style="color: var(--primary); text-decoration: none;">🏠 All Streams</a>
                <span style="margin: 0 8px; color: #cbd5e1;">›</span>
                <a href="#" onclick="loadL2Subtopics(${streamId}, '${streamName.replace(/'/g, "\\'")}'); return false;" 
                   style="color: var(--primary); text-decoration: none;">Stream #${streamId}</a>
                <span style="margin: 0 8px; color: #cbd5e1;">›</span>
                <strong>Subtopic ${subtopicId}: ${subtopicName}</strong>
            `;
            
            // Get papers for this L1-L2 combination
            const l2Num = parseInt(subtopicId.split('.')[1]);
            const papers = dashboardData.papers.filter(p => 
                p.l1 === streamId && p.l2 === l2Num
            );
            
            // Sort by citations descending
            papers.sort((a, b) => b.citations - a.citations);
            
            displayPaperList(papers, {
                streamId, streamName, subtopicId, subtopicName,
                title: `${papers.length} Papers in Subtopic ${subtopicId}: ${subtopicName}`,
                subtitle: `Stream #${streamId}: ${streamName}`
            });
        }
        
        // Display a list of papers (reusable function)
        function displayPaperList(papers, context) {
            const container = document.getElementById('explorerContent');
            
            let html = `
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 10px;">${context.title}</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 15px;">${context.subtitle}</p>
                    
                    <!-- Search Bar -->
                    <div style="margin-bottom: 15px;">
                        <input type="text" 
                               id="paperSearch" 
                               placeholder="🔍 Search papers by title, abstract, or keywords..." 
                               class="search-box"
                               oninput="filterPapers()"
                               style="width: 100%; padding: 12px 20px; border: 2px solid var(--border); border-radius: 10px; font-size: 1rem;">
                    </div>
                    
                    <!-- Advanced Filters Toggle -->
                    <div style="margin-bottom: 15px;">
                        <button onclick="toggleAdvancedFilters()" class="filter-btn" style="padding: 8px 16px; font-size: 0.9rem;">
                            ⚙️ Advanced Filters
                        </button>
                        <button onclick="resetFilters()" class="filter-btn" style="padding: 8px 16px; font-size: 0.9rem; margin-left: 10px;">
                            🔄 Reset Filters
                        </button>
                    </div>
                    
                    <!-- Advanced Filters Panel -->
                    <div id="advancedFilters" style="display: none; background: var(--light); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid var(--border);">
                        <h4 style="margin-top: 0; margin-bottom: 15px; color: var(--primary);">📊 Filter Options</h4>
                        
                        <!-- Year Range Filter -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                📅 Publication Year Range: <span id="yearRangeDisplay">1977 - 2026</span>
                            </label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="font-size: 0.9rem; color: #64748b;">1977</span>
                                <input type="range" id="yearMinFilter" min="1977" max="2026" value="1977" 
                                       oninput="updateYearRange(); filterPapers()" 
                                       style="flex: 1;">
                                <input type="range" id="yearMaxFilter" min="1977" max="2026" value="2026" 
                                       oninput="updateYearRange(); filterPapers()" 
                                       style="flex: 1;">
                                <span style="font-size: 0.9rem; color: #64748b;">2026</span>
                            </div>
                        </div>
                        
                        <!-- Citation Threshold Filter -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                🎯 Minimum Citations: <span id="citationThresholdDisplay">0</span>
                            </label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="font-size: 0.9rem; color: #64748b;">0</span>
                                <input type="range" id="citationFilter" min="0" max="500" value="0" step="10"
                                       oninput="updateCitationThreshold(); filterPapers()" 
                                       style="flex: 1;">
                                <span style="font-size: 0.9rem; color: #64748b;">500+</span>
                            </div>
                        </div>
                        
                        <!-- Journal Filter -->
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                📚 Journals
                            </label>
                            <div id="journalFilters" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Filters and Sort -->
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                        <!-- Sort Options -->
                        <button onclick="sortPapers('citations')" class="filter-btn" style="padding: 6px 12px; font-size: 0.9rem;">
                            📊 Sort by Citations
                        </button>
                        <button onclick="sortPapers('year-desc')" class="filter-btn" style="padding: 6px 12px; font-size: 0.9rem;">
                            📅 Newest First
                        </button>
                        <button onclick="sortPapers('year-asc')" class="filter-btn" style="padding: 6px 12px; font-size: 0.9rem;">
                            📅 Oldest First
                        </button>
                        
                        <!-- Export Options -->
                        <button onclick="exportPapers('csv')" class="filter-btn" style="padding: 6px 12px; font-size: 0.9rem; margin-left: auto;">
                            💾 Export CSV
                        </button>
                        <button onclick="exportPapers('bibtex')" class="filter-btn" style="padding: 6px 12px; font-size: 0.9rem;">
                            📚 Export BibTeX
                        </button>
                        <button onclick="exportPapers('json')" class="filter-btn" style="padding: 6px 12px; font-size: 0.9rem;">
                            📋 Export JSON
                        </button>
                    </div>
                    
                    <!-- Results Count -->
                    <p id="resultsCount" style="color: #64748b; font-size: 0.9rem; margin-bottom: 10px;">
                        Showing ${papers.length} paper${papers.length !== 1 ? 's' : ''}
                    </p>
                </div>
                <div id="papersList">
            `;
            
            papers.forEach((paper, idx) => {
                const doiLink = paper.doi ? `https://doi.org/${paper.doi}` : '#';
                const titleHtml = paper.doi 
                    ? `<a href="${doiLink}" target="_blank" rel="noopener noreferrer" style="color: var(--dark); text-decoration: none;">${paper.title}</a>`
                    : paper.title;
                
                const searchableText = `${paper.title} ${paper.abstract || ''} ${paper.l1Label || ''} ${paper.l3Label || ''}`.toLowerCase();
                
                html += `
                    <div class="paper-item" 
                         style="margin-bottom: 15px; padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 3px solid var(--primary);" 
                         data-year="${paper.year}" 
                         data-citations="${paper.citations}"
                         data-journal="${paper.journal}"
                         data-searchable="${searchableText}">
                        <div style="font-weight: 600; margin-bottom: 8px; font-size: 1.05rem;">
                            ${idx + 1}. ${titleHtml}
                        </div>
                        <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 6px;">
                            <span><strong>Year:</strong> ${paper.year}</span> • 
                            <span><strong>Journal:</strong> ${paper.journal}</span> • 
                            <span style="color: var(--accent); font-weight: 600;">🎯 ${paper.citations.toLocaleString()} citations</span>
                            ${paper.doi ? ` • <a href="${doiLink}" target="_blank" rel="noopener noreferrer" style="color: var(--primary); text-decoration: none;">📄 DOI</a>` : ''}
                        </div>
                        ${paper.abstract ? `
                            <div style="font-size: 0.85rem; color: #64748b; margin-top: 8px; line-height: 1.5;">
                                <strong>Abstract:</strong> ${paper.abstract.substring(0, 250)}${paper.abstract.length > 250 ? '...' : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            // Store current papers and context for sorting/filtering
            window.currentPapers = papers;
            window.currentContext = context;
            window.allCurrentPapers = papers; // Keep original unfiltered list
            
            // Populate journal filters
            populateJournalFilters(papers);
        }
        
        // Populate journal filter checkboxes
        function populateJournalFilters(papers) {
            const journalSet = new Set(papers.map(p => p.journal));
            const journals = Array.from(journalSet).sort();
            
            const container = document.getElementById('journalFilters');
            if (!container) return;
            
            container.innerHTML = journals.map(journal => `
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.9rem;">
                    <input type="checkbox" 
                           class="journal-filter-checkbox" 
                           value="${journal}" 
                           checked
                           onchange="filterPapers()"
                           style="cursor: pointer;">
                    <span>${journal}</span>
                </label>
            `).join('');
        }
        
        // Toggle advanced filters panel
        function toggleAdvancedFilters() {
            const panel = document.getElementById('advancedFilters');
            if (panel) {
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            }
        }
        
        // Update year range display
        function updateYearRange() {
            const minYear = document.getElementById('yearMinFilter');
            const maxYear = document.getElementById('yearMaxFilter');
            const display = document.getElementById('yearRangeDisplay');
            
            if (minYear && maxYear && display) {
                // Ensure min <= max
                if (parseInt(minYear.value) > parseInt(maxYear.value)) {
                    minYear.value = maxYear.value;
                }
                display.textContent = `${minYear.value} - ${maxYear.value}`;
            }
        }
        
        // Update citation threshold display
        function updateCitationThreshold() {
            const slider = document.getElementById('citationFilter');
            const display = document.getElementById('citationThresholdDisplay');
            
            if (slider && display) {
                display.textContent = slider.value;
            }
        }
        
        // Reset all filters
        function resetFilters() {
            // Reset search
            const searchInput = document.getElementById('paperSearch');
            if (searchInput) searchInput.value = '';
            
            // Reset year range
            const yearMin = document.getElementById('yearMinFilter');
            const yearMax = document.getElementById('yearMaxFilter');
            if (yearMin) yearMin.value = '1977';
            if (yearMax) yearMax.value = '2026';
            updateYearRange();
            
            // Reset citations
            const citationFilter = document.getElementById('citationFilter');
            if (citationFilter) citationFilter.value = '0';
            updateCitationThreshold();
            
            // Reset journal checkboxes
            const checkboxes = document.querySelectorAll('.journal-filter-checkbox');
            checkboxes.forEach(cb => cb.checked = true);
            
            // Reapply filters (which will show all)
            filterPapers();
        }
        
        // Sort papers in the current view
        function sortPapers(sortBy) {
            if (!window.currentPapers || !window.currentContext) return;
            
            const papers = [...window.currentPapers];
            
            if (sortBy === 'citations') {
                papers.sort((a, b) => b.citations - a.citations);
            } else if (sortBy === 'year-desc') {
                papers.sort((a, b) => b.year - a.year);
            } else if (sortBy === 'year-asc') {
                papers.sort((a, b) => a.year - b.year);
            }
            
            window.currentPapers = papers;
            
            // Reload with new sort
            displayPaperList(papers, window.currentContext);
        }
        
        // Filter papers based on search query and advanced filters
        function filterPapers() {
            if (!window.allCurrentPapers) return;
            
            let filtered = [...window.allCurrentPapers];
            
            // 1. Apply search filter
            const searchInput = document.getElementById('paperSearch');
            if (searchInput && searchInput.value.trim()) {
                const query = searchInput.value.toLowerCase().trim();
                filtered = filtered.filter(paper => {
                    const searchableText = `${paper.title} ${paper.abstract || ''} ${paper.l1Label || ''} ${paper.l3Label || ''}`.toLowerCase();
                    return searchableText.includes(query);
                });
            }
            
            // 2. Apply year range filter
            const yearMin = document.getElementById('yearMinFilter');
            const yearMax = document.getElementById('yearMaxFilter');
            if (yearMin && yearMax) {
                const minYear = parseInt(yearMin.value);
                const maxYear = parseInt(yearMax.value);
                filtered = filtered.filter(paper => {
                    const year = paper.year || 0;
                    return year >= minYear && year <= maxYear;
                });
            }
            
            // 3. Apply citation threshold filter
            const citationFilter = document.getElementById('citationFilter');
            if (citationFilter) {
                const minCitations = parseInt(citationFilter.value);
                filtered = filtered.filter(paper => (paper.citations || 0) >= minCitations);
            }
            
            // 4. Apply journal filter
            const journalCheckboxes = document.querySelectorAll('.journal-filter-checkbox:checked');
            if (journalCheckboxes.length > 0) {
                const selectedJournals = new Set(Array.from(journalCheckboxes).map(cb => cb.value));
                filtered = filtered.filter(paper => selectedJournals.has(paper.journal));
            }
            
            // Update current papers and display
            window.currentPapers = filtered;
            displayPaperList(filtered, window.currentContext);
        }
        
        // Export papers in different formats
        function exportPapers(format) {
            if (!window.currentPapers || window.currentPapers.length === 0) {
                alert('No papers to export!');
                return;
            }
            
            const papers = window.currentPapers;
            const context = window.currentContext || {title: 'Papers'};
            const filename = `papers_${context.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_${new Date().toISOString().split('T')[0]}`;
            
            if (format === 'csv') {
                exportCSV(papers, filename);
            } else if (format === 'bibtex') {
                exportBibTeX(papers, filename);
            } else if (format === 'json') {
                exportJSON(papers, filename);
            }
        }
        
        function exportCSV(papers, filename) {
            const headers = ['Title', 'Authors', 'Year', 'Journal', 'Citations', 'DOI', 'Abstract', 'Stream', 'Subtopic'];
            const rows = papers.map(p => [
                `"${(p.title || '').replace(/"/g, '""')}"`,
                `"${(p.authors || '').replace(/"/g, '""')}"`,
                p.year || '',
                `"${(p.journal || '').replace(/"/g, '""')}"`,
                p.citations || 0,
                p.doi || '',
                `"${(p.abstract || '').replace(/"/g, '""')}"`,
                `"${(p.l1Label || '').replace(/"/g, '""')}"`,
                `"${(p.l3Label || '').replace(/"/g, '""')}"`
            ].join(','));
            
            const csv = [headers.join(','), ...rows].join('\\n');
            downloadFile(csv, `${filename}.csv`, 'text/csv');
        }
        
        function exportBibTeX(papers, filename) {
            const bibtex = papers.map((paper, idx) => {
                const key = `${(paper.authors || 'unknown').split(',')[0].toLowerCase().replace(/[^a-z]/g, '')}${paper.year || ''}${paper.title.split(' ')[0].toLowerCase()}`;
                return `@article{${key},
  title = {${paper.title}},
  author = {${paper.authors || 'Unknown'}},
  journal = {${paper.journal}},
  year = {${paper.year}},
  doi = {${paper.doi || ''}},
  note = {Citations: ${paper.citations}}
}`;
            }).join('\\n\\n');
            
            downloadFile(bibtex, `${filename}.bib`, 'text/plain');
        }
        
        function exportJSON(papers, filename) {
            const json = JSON.stringify(papers, null, 2);
            downloadFile(json, `${filename}.json`, 'application/json');
        }
        
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // ===== TRENDS VISUALIZATION FUNCTIONS =====
        
        // ===== VISUALIZATIONS TAB CHARTS =====
        let visualizationsInitialized = false;
        let streamDistChart, journalContChart, citationDistChart, pubTimelineChart, keywordsChart, streamImpactChart;
        
        function initializeVisualizations() {
            if (visualizationsInitialized) return;
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded! Visualizations cannot be created.');
                return;
            }
            
            console.log('Initializing visualizations...');
            
            const papers = dashboardData.papers;
            const streams = dashboardData.streams.filter(s => s.id !== -1); // Exclude unclassified
            
            // 1. Stream Distribution (Doughnut Chart)
            createStreamDistributionChart(streams);
            
            // 2. Journal Contributions (Horizontal Bar Chart)
            createJournalContributionsChart(papers);
            
            // 3. Citation Distribution (Histogram)
            createCitationDistributionChart(papers);
            
            // 4. Publication Timeline (Area Chart)
            createPublicationTimelineChart(papers);
            
            // 5. Top Keywords (Bar Chart)
            createTopKeywordsChart(streams);
            
            // 6. Stream Impact (Bar Chart)
            createStreamImpactChart(streams);
            
            visualizationsInitialized = true;
        }
        
        function createStreamDistributionChart(streams) {
            const ctx = document.getElementById('streamDistributionChart');
            if (!ctx) return;
            
            const colors = [
                '#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b',
                '#10b981', '#06b6d4', '#6366f1', '#ef4444'
            ];
            
            streamDistChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: streams.map(s => s.title),
                    datasets: [{
                        data: streams.map(s => s.size),
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 15,
                                padding: 10,
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} papers (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function createJournalContributionsChart(papers) {
            const ctx = document.getElementById('journalContributionsChart');
            if (!ctx) return;
            
            // Count papers by journal
            const journalCounts = {};
            papers.forEach(p => {
                const journal = p.journal_short || p.journal;
                journalCounts[journal] = (journalCounts[journal] || 0) + 1;
            });
            
            const sortedJournals = Object.entries(journalCounts)
                .sort((a, b) => b[1] - a[1]);
            
            journalContChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedJournals.map(j => j[0]),
                    datasets: [{
                        label: 'Total Papers',
                        data: sortedJournals.map(j => j[1]),
                        backgroundColor: '#3b82f6',
                        borderColor: '#2563eb',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.x} papers`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Papers'
                            }
                        }
                    }
                }
            });
        }
        
        function createCitationDistributionChart(papers) {
            const ctx = document.getElementById('citationDistributionChart');
            if (!ctx) return;
            
            // Create bins for citation counts
            const bins = [0, 10, 25, 50, 100, 200, 500, 1000, 10000];
            const binLabels = ['0-9', '10-24', '25-49', '50-99', '100-199', '200-499', '500-999', '1000+'];
            const binCounts = new Array(bins.length - 1).fill(0);
            
            papers.forEach(p => {
                const citations = p.citation_count || 0;
                for (let i = 0; i < bins.length - 1; i++) {
                    if (citations >= bins[i] && citations < bins[i + 1]) {
                        binCounts[i]++;
                        break;
                    }
                }
            });
            
            citationDistChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Number of Papers',
                        data: binCounts,
                        backgroundColor: '#8b5cf6',
                        borderColor: '#7c3aed',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed.y / total) * 100).toFixed(1);
                                    return `${context.parsed.y} papers (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Papers'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Citation Count Range'
                            }
                        }
                    }
                }
            });
        }
        
        function createPublicationTimelineChart(papers) {
            const ctx = document.getElementById('publicationTimelineChart');
            if (!ctx) return;
            
            // Count papers by year
            const yearCounts = {};
            papers.forEach(p => {
                const year = p.year;
                if (year) {
                    yearCounts[year] = (yearCounts[year] || 0) + 1;
                }
            });
            
            const sortedYears = Object.keys(yearCounts).sort();
            const years = sortedYears.map(y => parseInt(y));
            const counts = sortedYears.map(y => yearCounts[y]);
            
            pubTimelineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Papers Published',
                        data: counts,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: '#3b82f6',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return `Year ${context[0].label}`;
                                },
                                label: function(context) {
                                    return `${context.parsed.y} papers published`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Papers Published'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Year'
                            },
                            ticks: {
                                maxTicksLimit: 15
                            }
                        }
                    }
                }
            });
        }
        
        function createTopKeywordsChart(streams) {
            const ctx = document.getElementById('topKeywordsChart');
            if (!ctx) return;
            
            // Collect all keywords with their frequencies
            const keywordCounts = {};
            streams.forEach(stream => {
                if (stream.topKeywords) {
                    stream.topKeywords.forEach(kw => {
                        keywordCounts[kw] = (keywordCounts[kw] || 0) + 1;
                    });
                }
            });
            
            // Get top 15 keywords
            const topKeywords = Object.entries(keywordCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15);
            
            keywordsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topKeywords.map(k => k[0]),
                    datasets: [{
                        label: 'Frequency',
                        data: topKeywords.map(k => k[1]),
                        backgroundColor: '#10b981',
                        borderColor: '#059669',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Appears in ${context.parsed.y} streams`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Streams'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Keywords'
                            },
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }
        
        function createStreamImpactChart(streams) {
            const ctx = document.getElementById('streamImpactChart');
            if (!ctx) return;
            
            const sortedStreams = streams
                .map(s => ({
                    title: s.title,
                    avgCitations: s.avgCitations || 0
                }))
                .sort((a, b) => b.avgCitations - a.avgCitations);
            
            streamImpactChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedStreams.map(s => s.title),
                    datasets: [{
                        label: 'Average Citations',
                        data: sortedStreams.map(s => s.avgCitations),
                        backgroundColor: '#ec4899',
                        borderColor: '#db2777',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Avg: ${context.parsed.x.toFixed(1)} citations/paper`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Average Citations per Paper'
                            }
                        }
                    }
                }
            });
        }
        
        // ===== TRENDS TAB CHARTS =====
        let trendsChartsInitialized = false;
        let streamTimelineChart, cumulativeGrowthChart, journalDecadeChart, emergingTopicsBubbleChart;
        
        function initializeTrendsCharts() {
            if (trendsChartsInitialized) return;
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded! Charts cannot be created.');
                return;
            }
            
            console.log('Initializing trends charts...');
            console.log('Dashboard data:', dashboardData);
            console.log('Chart.js version:', Chart.version);
            
            // Prepare data from dashboardData
            const papers = dashboardData.papers;
            const streams = dashboardData.streams.filter(s => s.id !== -1); // Exclude unclassified
            
            console.log(`Found ${streams.length} streams and ${papers.length} papers`);
            
            // 1. Stream Timeline Data (papers per year by stream)
            const yearlyStreamData = {};
            papers.forEach(paper => {
                if (paper.l1 !== undefined && paper.l1 !== -1 && paper.year) {
                    const year = paper.year;
                    if (!yearlyStreamData[year]) yearlyStreamData[year] = {};
                    if (!yearlyStreamData[year][paper.l1]) yearlyStreamData[year][paper.l1] = 0;
                    yearlyStreamData[year][paper.l1]++;
                }
            });
            
            console.log('Yearly stream data prepared:', Object.keys(yearlyStreamData).length, 'years');
            
            createStreamTimelineChart(yearlyStreamData, streams);
            createCumulativeGrowthChart(papers);
            createJournalDecadeChart(papers);
            createEmergingTopicsBubbleChart(streams);
            createActivityHeatmap(yearlyStreamData, streams);
            
            trendsChartsInitialized = true;
            console.log('Trends charts initialization complete');
        }
        
        function createStreamTimelineChart(yearlyData, streams) {
            const ctx = document.getElementById('streamTimelineChart');
            if (!ctx) {
                console.error('Canvas element streamTimelineChart not found');
                return;
            }
            
            console.log('Creating stream timeline chart...');
            
            const years = Object.keys(yearlyData).map(Number).sort((a, b) => a - b);
            const streamColors = [
                '#2563eb', '#7c3aed', '#db2777', '#059669', 
                '#d97706', '#dc2626', '#0891b2', '#4f46e5'
            ];
            
            const datasets = streams.map((stream, idx) => ({
                label: stream.title,
                data: years.map(year => yearlyData[year]?.[stream.id] || 0),
                borderColor: streamColors[idx % streamColors.length],
                backgroundColor: streamColors[idx % streamColors.length] + '20',
                fill: false,
                tension: 0.3
            }));
            
            console.log(`Timeline chart: ${years.length} years, ${datasets.length} streams`);
            
            streamTimelineChart = new Chart(ctx, {
                type: 'line',
                data: { labels: years, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 10 } } },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Papers per Year' } },
                        x: { title: { display: true, text: 'Year' } }
                    }
                }
            });
        }
        
        function createCumulativeGrowthChart(papers) {
            const ctx = document.getElementById('cumulativeGrowthChart');
            if (!ctx) return;
            
            const yearCounts = {};
            papers.forEach(p => {
                const year = p.year;
                if (year) yearCounts[year] = (yearCounts[year] || 0) + 1;
            });
            
            const years = Object.keys(yearCounts).map(Number).sort((a, b) => a - b);
            let cumulative = 0;
            const cumulativeData = years.map(year => {
                cumulative += yearCounts[year] || 0;
                return cumulative;
            });
            
            cumulativeGrowthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Total Papers',
                        data: cumulativeData,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: ctx => `Total: ${ctx.parsed.y.toLocaleString()} papers` } }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Cumulative Papers' } },
                        x: { title: { display: true, text: 'Year' } }
                    }
                }
            });
        }
        
        function createJournalDecadeChart(papers) {
            const ctx = document.getElementById('journalDecadeChart');
            if (!ctx) return;
            
            const journals = [...new Set(papers.map(p => p.journal))].sort();
            const decades = ['1977-1989', '1990-1999', '2000-2009', '2010-2019', '2020-2026'];
            
            const decadeData = decades.map(() => ({}));
            papers.forEach(p => {
                const year = p.year;
                let decadeIdx = -1;
                if (year >= 1977 && year <= 1989) decadeIdx = 0;
                else if (year >= 1990 && year <= 1999) decadeIdx = 1;
                else if (year >= 2000 && year <= 2009) decadeIdx = 2;
                else if (year >= 2010 && year <= 2019) decadeIdx = 3;
                else if (year >= 2020 && year <= 2026) decadeIdx = 4;
                
                if (decadeIdx >= 0) {
                    if (!decadeData[decadeIdx][p.journal]) decadeData[decadeIdx][p.journal] = 0;
                    decadeData[decadeIdx][p.journal]++;
                }
            });
            
            const journalColors = [
                '#2563eb', '#7c3aed', '#db2777', '#059669',
                '#d97706', '#dc2626', '#0891b2', '#4f46e5'
            ];
            
            const datasets = journals.map((journal, idx) => ({
                label: journal,
                data: decades.map((_, di) => decadeData[di][journal] || 0),
                backgroundColor: journalColors[idx % journalColors.length]
            }));
            
            journalDecadeChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: decades, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 10 } } }
                    },
                    scales: {
                        x: { stacked: true, title: { display: true, text: 'Decade' } },
                        y: { stacked: true, beginAtZero: true, title: { display: true, text: 'Papers' } }
                    }
                }
            });
        }
        
        function createEmergingTopicsBubbleChart(streams) {
            const ctx = document.getElementById('emergingTopicsBubbleChart');
            if (!ctx) return;
            
            const data = streams.map(stream => ({
                x: stream.avgYear || 2000,
                y: stream.avgCitations || 0,
                r: Math.sqrt(stream.size) / 3, // Bubble size proportional to paper count
                label: stream.title,
                papers: stream.size
            }));
            
            emergingTopicsBubbleChart = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Research Streams',
                        data: data,
                        backgroundColor: 'rgba(37, 99, 235, 0.6)',
                        borderColor: '#2563eb',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => {
                                    const item = ctx.raw;
                                    return [
                                        item.label,
                                        `Avg Year: ${item.x.toFixed(1)}`,
                                        `Avg Citations: ${item.y.toFixed(1)}`,
                                        `Papers: ${item.papers}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Average Publication Year' }, min: 1990, max: 2025 },
                        y: { title: { display: true, text: 'Average Citations' }, beginAtZero: true }
                    }
                }
            });
        }
        
        function createActivityHeatmap(yearlyData, streams) {
            const container = document.getElementById('activityHeatmap');
            if (!container) return;
            
            const periods = ['1977-1984', '1985-1994', '1995-2004', '2005-2014', '2015-2026'];
            
            const periodData = streams.map(stream => {
                return periods.map((_, pidx) => {
                    const startYear = 1977 + (pidx * 10) - (pidx === 0 ? 0 : 2);
                    const endYear = pidx === periods.length - 1 ? 2026 : startYear + 9;
                    let count = 0;
                    for (let year = startYear; year <= endYear; year++) {
                        count += (yearlyData[year]?.[stream.id] || 0);
                    }
                    return count;
                });
            });
            
            const maxCount = Math.max(...periodData.flat());
            
            let html = '<table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">';
            html += '<tr><th style="text-align: left; padding: 8px; border: 1px solid #e2e8f0;">Stream</th>';
            periods.forEach(p => html += `<th style="padding: 8px; border: 1px solid #e2e8f0;">${p}</th>`);
            html += '</tr>';
            
            streams.forEach((stream, sidx) => {
                html += `<tr><td style="padding: 8px; border: 1px solid #e2e8f0; font-weight: 500;">${stream.title}</td>`;
                periodData[sidx].forEach(count => {
                    const intensity = maxCount > 0 ? count / maxCount : 0;
                    const color = `rgba(37, 99, 235, ${0.1 + intensity * 0.9})`;
                    html += `<td style="padding: 8px; border: 1px solid #e2e8f0; background: ${color}; text-align: center;">${count}</td>`;
                });
                html += '</tr>';
            });
            html += '</table>';
            
            container.innerHTML = html;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('IS Research Streams Explorer loaded successfully!');
        });
    </script>
</body>
</html>
